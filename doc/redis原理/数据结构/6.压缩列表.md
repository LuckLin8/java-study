## 压缩列表
压缩列表（ziplist）是list和hash的底层实现之一。

当一个list只包含少量列表项， 并且每个节点要么就是小整数值， 要么就是长度比较短的字符串， 那么 Redis 就会使用压缩列表来做list的底层实现。
## 实现
压缩列表是 Redis 为了节约内存而开发的， 由一系列特殊编码的连续内存块组成的顺序型（sequential）数据结构。

一个压缩列表可以包含任意多个节点（entry）， 每个节点可以保存一个字节数组或者一个整数值。

![压缩列表](https://youdaoyun1.oss-cn-shenzhen.aliyuncs.com/ES/%E5%8E%8B%E7%BC%A9%E5%88%97%E8%A1%A8%E7%BB%93%E6%9E%84.png)

- zlbytes 记录整个压缩列表占用的内存字节数：在对压缩列表进行内存重分配， 或者计算 zlend 的位置时使用。
- zltail 记录压缩列表表尾节点距离压缩列表的起始地址有多少字节： 通过这个偏移量，程序无须遍历整个压缩列表就可以确定表尾节点的地址。
- zllen 记录了压缩列表包含的节点数量： 当这个属性的值小于 UINT16_MAX （65535）时， 这个属性的值就是压缩列表包含节点的数量； 当这个值等于 UINT16_MAX 时， 节点的真实数量需要遍历整个压缩列表才能计算得出。
- entryX 压缩列表包含的各个节点，节点的长度由节点保存的内容决定。
- zlend 特殊值 0xFF （十进制 255 ），用于标记压缩列表的末端。

每个压缩列表节点可以保存一个字节数组或者一个整数值， 其中， 字节数组可以是以下三种长度的其中一种：

    长度小于等于 63 （2^{6}-1）字节的字节数组；
    长度小于等于 16383 （2^{14}-1） 字节的字节数组；
    长度小于等于 4294967295 （2^{32}-1）字节的字节数组；

而整数值则可以是以下六种长度的其中一种：

    4 位长，介于 0 至 12 之间的无符号整数；
    1 字节长的有符号整数；
    3 字节长的有符号整数；
    int16_t 类型整数；
    int32_t 类型整数；
    int64_t 类型整数。
## 重点
- 压缩列表是一种为节约内存而开发的顺序型数据结构。
- 压缩列表被用作列表键和哈希键的底层实现之一。
- 压缩列表可以包含多个节点，每个节点可以保存一个字节数组或者整数值。
- 添加新节点到压缩列表， 或者从压缩列表中删除节点， 可能会引发连锁更新操作， 但这种操作出现的几率并不高。